<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Analyseur RSS Intelligent{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∞</text></svg>">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            important: true,
            theme: {
                extend: {
                    typography: {
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                            }
                        }
                    }
                }
            }
        }
    </script>
    <script>
        tailwind.config = { important: true }
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .sidebar {
            transition: all 0.3s ease;
        }

        .content {
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

                .sidebar.active {
                    transform: translateX(0);
                }
        }

        .sentiment-positive {
            color: #10B981;
        }

        .sentiment-negative {
            color: #EF4444;
        }

        .sentiment-neutral {
            color: #6B7280;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .max-h-96 {
            max-height: 24rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Am√©liorations pour les graphiques */
        .chart-container {
            position: relative;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            padding: 1rem;
        }

        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #6B7280;
        }

        .chart-error {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #EF4444;
            background-color: #FEF2F2;
            border-radius: 8px;
            border: 1px solid #FECACA;
        }

        /* Animations am√©lior√©es */
        .stat-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

            .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }

        .counter-animation {
            font-variant-numeric: tabular-nums;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .chart-container {
                padding: 0.5rem;
            }

            .stat-card {
                margin-bottom: 1rem;
            }
        }

        /* Gradient backgrounds for themes */
        .theme-item {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%);
            transition: all 0.3s ease;
        }

            .theme-item:hover {
                background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%);
                transform: translateX(4px);
            }

        /* Progress bar animation */
        .progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Pulse animation for loading states */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Chart tooltips enhancement */
        .chartjs-tooltip {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.9) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-indigo-600 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <button id="menuToggle" class="md:hidden text-xl">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="text-2xl font-bold">
                        <i class="fas fa-rss-square mr-2"></i>
                        Analyseur RSS
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="currentTime" class="text-sm"></span>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Sidebar -->
        <div class="sidebar w-64 bg-white shadow-lg min-h-screen fixed md:relative z-10">
            <div class="p-6">
                <nav class="space-y-2">

                    <a href="/" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-home w-6"></i>
                        <span>Accueil</span>
                    </a>

                    <a href="/dashboard" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-chart-bar w-6"></i>
                        <span>Tableau de bord</span>
                    </a>

                    <a href="#" class="nav-themes flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-tags w-6"></i>
                        <span>Gestion des th√®mes</span>
                    </a>

                    <a href="#" class="nav-articles flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-newspaper w-6"></i>
                        <span>Articles</span>
                    </a>

                    <a href="#" class="nav-filters flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-filter w-6"></i>
                        <span>Filtres avanc√©s</span>
                    </a>

                    <a href="#" class="nav-advanced flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-microscope w-6"></i>
                        <span>Analyse avanc√©e</span>
                    </a>

                    <a href="#" class="nav-settings flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-cog w-6"></i>
                        <span>Param√®tres</span>
                    </a>

                    <hr class="my-4">

                    <a href="/social" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-share-alt w-6"></i>
                        <span>R√©seaux Sociaux</span>
                    </a>

                    <a href="/archiviste" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-archive w-6"></i>
                        <span>Archiviste</span>
                    </a>

                    <a href="/weak-indicators" class="nav-weak-indicators flex items-center space-x-3 p-3 rounded-lg hover:bg-indigo-50 text-gray-700 hover:text-indigo-600">
                        <i class="fas fa-chart-line w-6"></i>
                        <span>Indicateurs Faibles</span>
                    </a>

                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content flex-1 md:ml-0">
            <main class="container mx-auto px-4 py-8">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <!-- Overlay for mobile menu -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-0 hidden md:hidden"></div>

    <!-- Modal G√©n√©rique -->
    <div id="themeManagerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 md:w-3/4 max-w-6xl max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800" id="modalTitle">Gestion des Th√®mes</h3>
                    <button id="closeThemeManager" class="text-gray-500 hover:text-gray-700 text-xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto max-h-[70vh]" id="themeManagerContent">
                <!-- Contenu charg√© dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Scripts JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/themes.js') }}"></script>
    <script src="{{ url_for('static', filename='js/themes-advanced.js') }}"></script>
    <script src="{{ url_for('static', filename='js/articles.js') }}"></script>
    <script src="{{ url_for('static', filename='js/feeds.js') }}"></script>
    <script src="{{ url_for('static', filename='js/filters.js') }}"></script>
    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
    <script src="{{ url_for('static', filename='js/advanced-analysis.js') }}"></script>
    <script src="{{ url_for('static', filename='js/weak-indicators.js') }}"></script>

    {% if request.path == '/dashboard' %}
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    {% endif %}

    <script>
        // Ajout du gestionnaire pour les filtres
        document.addEventListener('DOMContentLoaded', function () {
            const navFilters = document.querySelector('.nav-filters');
            if (navFilters) {
                navFilters.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (typeof FilterManager !== 'undefined') {
                        FilterManager.showAdvancedFilters();
                    } else {
                        console.error('FilterManager non disponible');
                    }
                });
            }
        });

        // Gestionnaire pour l'analyse avanc√©e
        document.addEventListener('DOMContentLoaded', function () {
            const navAdvanced = document.querySelector('.nav-advanced');
            if (navAdvanced) {
                navAdvanced.addEventListener('click', function (e) {
                    e.preventDefault();
                    if (typeof AdvancedAnalysisManager !== 'undefined') {
                        AdvancedAnalysisManager.showAnalysisPanel();
                    } else {
                        console.error('AdvancedAnalysisManager non disponible');
                        // Fallback - charger le script dynamiquement
                        loadAdvancedAnalysisScript();
                    }
                });
            }
        });

        function loadAdvancedAnalysisScript() {
            const script = document.createElement('script');
            script.src = "{{ url_for('static', filename='js/advanced-analysis.js') }}";
            script.onload = function () {
                if (typeof AdvancedAnalysisManager !== 'undefined') {
                    AdvancedAnalysisManager.showAnalysisPanel();
                }
            };
            document.head.appendChild(script);
        }

    </script>

    <!-- Am√©liorations Chart.js globales -->
    <script>
        // Configuration globale de Chart.js
        Chart.defaults.font.family = "'Inter', 'Segoe UI', 'Roboto', sans-serif";
        Chart.defaults.color = '#374151';
        Chart.defaults.borderColor = 'rgba(0, 0, 0, 0.1)';
        Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(0, 0, 0, 0.8)';
        Chart.defaults.plugins.tooltip.titleColor = '#FFFFFF';
        Chart.defaults.plugins.tooltip.bodyColor = '#FFFFFF';
        Chart.defaults.plugins.tooltip.borderColor = '#FFFFFF';
        Chart.defaults.plugins.tooltip.borderWidth = 1;
        Chart.defaults.plugins.tooltip.cornerRadius = 8;

        // Am√©lioration des animations
        Chart.defaults.animation.duration = 1000;
        Chart.defaults.animation.easing = 'easeInOutCubic';

        // Configuration responsive
        Chart.defaults.responsive = true;
        Chart.defaults.maintainAspectRatio = false;

    
        // Fonction utilitaire pour cr√©er des gradients (sans plugin)
        function createGradient(ctx, startColor, endColor) {
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, startColor);
            gradient.addColorStop(1, endColor);
            return gradient;
        }

        // Gestionnaire d'erreurs global pour Chart.js
        Chart.register({
            id: 'errorHandler',
            afterInit: function (chart) {
                // Optimisation des performances pour les gros datasets
                if (chart.data.labels && chart.data.labels.length > 100) {
                    chart.options.animation = false;
                }
            }
        });

        console.log('‚úÖ Chart.js global enhancements loaded');
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>